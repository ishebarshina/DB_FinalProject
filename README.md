# DB_FinalProject

#### Итоговый проект по курсу Основы реляционных баз данных MySQL

## Требования к курсовому проекту:

1. Составить общее текстовое описание БД и решаемых ею задач;
2. Минимальное количество таблиц - 10;
3. Скрипты создания структуры БД (с первичными ключами, индексами, внешними ключами);
4. Создать ERDiagram для БД;
5. Скрипты наполнения БД данными;
6. Скрипты характерных выборок (включающие группировки, JOIN'ы, вложенные таблицы);
7. Представления (минимум 2);
8. Хранимые процедуры / триггеры.

## Описание проекта

В данном проекте реализована модель хранения данных в интернет-магазине по типу Ozon, в котором действует система скидок и кешбэка.

#### Пользователи: users, profiles, cities
Каждый пользователь регистрируется по уникальному номеру телефону и email (таблица users)
В профиле profiles указаны личные данные пользователя: имя пользователя, дата рождения и тд

#### Система кэшбека: ozon_card, cashback_ozon_card, payment_cards
У каждого пользователя может быть ozon card. Карта ozon card привязана к аккаунту пользователя. 
Пользователь user_id = 1 не может расплачиваться картой ozon_card, которая привязана к аккаунту другого пользователя.
Если заказ оплачивается картой ozon_card, то на эту карту начисляется кешбэк в виде баллов.
По умолчанию кешбэк составляет 5% на все заказы в интернет-магазине. 
Однако, есть список каталогов (catalogs) товаров, на который действует повышенный кешбэк (cashback_ozon_card).
Процент по кешбэку начисляется от суммы заказа с учетом скидки
Если оплата происходит по карте не ozon_card, а другой (случайные номера сохраненных пользователями карт находятся в payment_cards), то никакого кешбэка нет.

#### Скидки: discounts
Скидки могут быть персональными (когда fk_d_user_id IS NOT NULL). Если  fk_d_user_id IS NULL, то скидка для всех пользователей.
Скидки могут быть на отдельные товары. Если  fk_d_products_id IS NULL, то скидка на все товары.
Два эти поля не могут быть NULL одновременно 
Кроме того, некоторые скидки действуют только при оплате заказа картой ozon_card

#### Товары: products, shops, products_shops, catalogs
Одни и те же наименования товаров (products) могут продаваться разными магазинами (shops), за разную цену. В таблице products_shops указано наименование товара, магазин, количество данного товара в магазине, а также его цена. Рейтинг выставляется товару вне зависимости от магазина, который его продает.

#### Рейтинг и отзывы: reviews 
Пользователи могут оставлять отзывы на купленный товар. отзыв представляет собой не столько письменное описание товара пользователем, сколько оценка (1, 2, 3, 4 или 5), которую пользователь ставит товару, и из которой впоследствии складывается рейтинг товара products.rating.

#### Избранное: favourites
Пользователи могут добавлять товар в избранное.

#### Заказы: orders, orders_products
В таблицах orders и orders_products описаны сделанные пользователями заказы.

## ERDiagram
![ER Diaram](/ERDiagram/ER_ozon_3.svg)
